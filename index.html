<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="USDT Tracker">
    <meta name="description" content="Registro profesional de transacciones USDT">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    <title>USDT Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
            min-height: 100vh;
        }
        .tab-active {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .tab-inactive {
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.6);
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-[1800px] mx-auto">
        <div class="bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/20">
            <!-- Header -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-3">
                    <svg class="w-10 h-10 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h1 class="text-4xl font-bold text-white">USDT Tracker Pro</h1>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-2 mb-6 flex-wrap">
                <button onclick="cambiarTab('betcris')" id="tabBetcris" class="tab-active px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer">
                    üí∞ Betcris
                </button>
                <button onclick="cambiarTab('rusos')" id="tabRusos" class="tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer">
                    üá∑üá∫ Ventas Rusos
                </button>
                <button onclick="cambiarTab('transacciones')" id="tabTransacciones" class="tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer">
                    üìä Transacciones
                </button>
                <button onclick="cambiarTab('graficas')" id="tabGraficas" class="tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer">
                    üìà Gr√°ficas
                </button>
            </div>

            <!-- SECCI√ìN BETCRIS -->
            <div id="seccionBetcris">
                <!-- Dashboard Betcris -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 rounded-xl p-6 border border-yellow-500/30">
                        <h3 class="text-yellow-300 font-semibold mb-2 text-lg">üíµ Total a Liquidar</h3>
                        <p class="text-white text-3xl font-bold" id="totalALiquidarBetcris">0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-xl p-6 border border-emerald-500/30">
                        <h3 class="text-emerald-300 font-semibold mb-2 text-lg">‚úÖ USDT Comprados</h3>
                        <p class="text-white text-3xl font-bold" id="totalCompradosBetcris">0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-500/20 to-red-600/20 rounded-xl p-6 border border-red-500/30">
                        <h3 class="text-red-300 font-semibold mb-2 text-lg">‚è≥ Pendiente</h3>
                        <p class="text-white text-3xl font-bold" id="pendienteBetcris">0.00</p>
                    </div>
                </div>

                <!-- Formulario Recogida -->
                <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                    <h2 class="text-xl font-semibold text-white mb-4">üí∞ Nueva Recogida Betcris</h2>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <input type="date" id="fechaRecogidaBetcris" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="montoDOPBetcris" placeholder="Monto DOP" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="montoUSDBetcris" placeholder="Monto USD" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="tasaDiaBetcris" placeholder="Tasa DOP‚ÜíUSD" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <button onclick="agregarRecogidaBetcris()" class="bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg px-6 py-2 font-semibold">
                            Agregar
                        </button>
                    </div>
                </div>

                <!-- Tabla Recogidas -->
                <div class="overflow-x-auto mb-6">
                    <h3 class="text-white font-semibold text-lg mb-3">üìã Recogidas</h3>
                    <table class="w-full text-white text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-3">Fecha</th>
                                <th class="text-right py-3 px-3">DOP</th>
                                <th class="text-right py-3 px-3">USD</th>
                                <th class="text-right py-3 px-3">Tasa</th>
                                <th class="text-right py-3 px-3">Total USD</th>
                                <th class="text-right py-3 px-3">USDT a Liquidar</th>
                                <th class="text-center py-3 px-3">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tablaRecogidasBetcris"></tbody>
                    </table>
                </div>

                <!-- Formulario Compra Betcris -->
                <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                    <h2 class="text-xl font-semibold text-white mb-4">üí≥ Compra USDT para Liquidar</h2>
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                        <input type="date" id="fechaCompraBetcris" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="cantidadUSDTBetcris" placeholder="Cantidad USDT" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="precioUSDTBetcris" placeholder="Precio" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <select id="divisaCompraBetcris" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                            <option value="DOP">DOP</option>
                            <option value="USD">USD</option>
                        </select>
                        <input type="text" id="notasCompraBetcris" placeholder="Notas" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <button onclick="agregarCompraBetcris()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-6 py-2 font-semibold">
                            Agregar
                        </button>
                    </div>
                </div>

                <!-- Tabla Compras Betcris -->
                <div class="overflow-x-auto">
                    <h3 class="text-white font-semibold text-lg mb-3">üí≥ Compras para Liquidar</h3>
                    <table class="w-full text-white text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-3">Fecha</th>
                                <th class="text-right py-3 px-3">USDT</th>
                                <th class="text-right py-3 px-3">Precio</th>
                                <th class="text-center py-3 px-3">Divisa</th>
                                <th class="text-right py-3 px-3">Total</th>
                                <th class="text-left py-3 px-3">Notas</th>
                                <th class="text-center py-3 px-3">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tablaComprasBetcris"></tbody>
                    </table>
                </div>
            </div>

            <!-- SECCI√ìN RUSOS -->
            <div id="seccionRusos" class="hidden">
                <!-- Dashboard Rusos -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 rounded-xl p-6 border border-purple-500/30">
                        <h3 class="text-purple-300 font-semibold mb-2 text-lg">üí∞ Ganancia Total</h3>
                        <p class="text-white text-3xl font-bold" id="gananciaTotalRusos">$0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-6 border border-blue-500/30">
                        <h3 class="text-blue-300 font-semibold mb-2 text-lg">üë§ Tu Parte (50%)</h3>
                        <p class="text-white text-3xl font-bold" id="tuParteRusos">$0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-cyan-500/20 to-cyan-600/20 rounded-xl p-6 border border-cyan-500/30">
                        <h3 class="text-cyan-300 font-semibold mb-2 text-lg">ü§ù Socio (50%)</h3>
                        <p class="text-white text-3xl font-bold" id="parteSocioRusos">$0.00</p>
                    </div>
                </div>

                <!-- Formulario Rusos -->
                <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                    <h2 class="text-xl font-semibold text-white mb-4">üá∑üá∫ Nueva Venta a Rusos</h2>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <input type="date" id="fechaRusos" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="cantidadUSDTRusos" placeholder="USDT Recibidos" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="porcentajeRusos" placeholder="% Ganancia" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="text" id="notasRusos" placeholder="Notas" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <button onclick="agregarVentaRusos()" class="bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg px-6 py-2 font-semibold">
                            Agregar
                        </button>
                    </div>
                </div>

                <!-- Tabla Rusos -->
                <div class="overflow-x-auto">
                    <table class="w-full text-white text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-3">Fecha</th>
                                <th class="text-right py-3 px-3">USDT</th>
                                <th class="text-right py-3 px-3">%</th>
                                <th class="text-right py-3 px-3">Ganancia Total</th>
                                <th class="text-right py-3 px-3">Tu Parte</th>
                                <th class="text-right py-3 px-3">Socio</th>
                                <th class="text-left py-3 px-3">Notas</th>
                                <th class="text-center py-3 px-3">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tablaVentasRusos"></tbody>
                    </table>
                </div>
            </div>

            <!-- SECCI√ìN TRANSACCIONES -->
            <div id="seccionTransacciones" class="hidden">
                <div class="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                    <h2 class="text-xl font-semibold text-white mb-4">üìä Nueva Transacci√≥n</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <select id="tipo" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                            <option value="Compra">Compra</option>
                            <option value="Venta">Venta</option>
                        </select>
                        <input type="number" id="cantidadUSDT" placeholder="Cantidad USDT" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <select id="divisaPago" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                            <option value="DOP">Pagado en DOP</option>
                            <option value="USD">Pagado en USD</option>
                        </select>
                        <input type="date" id="fecha" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                        <select id="divisaPrecios" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                            <option value="DOP">Precios en DOP</option>
                            <option value="USD">Precios en USD</option>
                        </select>
                        <input type="number" id="precioMercado" placeholder="Precio Mercado" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="tuPrecio" placeholder="Tu Precio" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="number" id="tasaCambio" placeholder="Tasa" step="0.01" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <input type="text" id="notas" placeholder="Notas" class="bg-slate-800 text-white rounded-lg px-4 py-2 border border-slate-600">
                        <button onclick="agregarTransaccion()" class="bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg px-6 py-2 font-semibold">
                            Agregar
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 rounded-xl p-6 border border-emerald-500/30">
                        <h3 class="text-emerald-300 font-semibold mb-2">Comprados</h3>
                        <p class="text-white text-3xl font-bold" id="totalComprados">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-500/20 to-orange-600/20 rounded-xl p-6 border border-orange-500/30">
                        <h3 class="text-orange-300 font-semibold mb-2">Vendidos</h3>
                        <p class="text-white text-3xl font-bold" id="totalVendidos">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-6 border border-blue-500/30">
                        <h3 class="text-blue-300 font-semibold mb-2">Balance</h3>
                        <p class="text-white text-3xl font-bold" id="balanceUSDT">0</p>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-white text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-3">Tipo</th>
                                <th class="text-right py-3 px-3">USDT</th>
                                <th class="text-center py-3 px-3">Divisa</th>
                                <th class="text-right py-3 px-3">P. Mercado</th>
                                <th class="text-right py-3 px-3">Tu Precio</th>
                                <th class="text-right py-3 px-3">Ganancia</th>
                                <th class="text-center py-3 px-3">Fecha</th>
                                <th class="text-center py-3 px-3">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tablaTransacciones"></tbody>
                    </table>
                </div>
            </div>

            <!-- SECCI√ìN GR√ÅFICAS -->
            <div id="seccionGraficas" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white/5 rounded-xl p-6 border border-white/10">
                        <h3 class="text-white font-semibold mb-4">Ganancias</h3>
                        <canvas id="graficoGanancias"></canvas>
                    </div>
                    <div class="bg-white/5 rounded-xl p-6 border border-white/10">
                        <h3 class="text-white font-semibold mb-4">Compras vs Ventas</h3>
                        <canvas id="graficoComprasVentas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let transacciones = [];
        let recogidasBetcris = [];
        let comprasBetcris = [];
        let ventasRusos = [];

        window.onload = function() {
            cargarDatos();
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = hoy;
            document.getElementById('fechaRecogidaBetcris').value = hoy;
            document.getElementById('fechaCompraBetcris').value = hoy;
            document.getElementById('fechaRusos').value = hoy;
        };

        function cambiarTab(tab) {
            document.getElementById('tabBetcris').className = 'tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
            document.getElementById('tabRusos').className = 'tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
            document.getElementById('tabTransacciones').className = 'tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
            document.getElementById('tabGraficas').className = 'tab-inactive px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
            
            document.getElementById('seccionBetcris').classList.add('hidden');
            document.getElementById('seccionRusos').classList.add('hidden');
            document.getElementById('seccionTransacciones').classList.add('hidden');
            document.getElementById('seccionGraficas').classList.add('hidden');
            
            if (tab === 'betcris') {
                document.getElementById('tabBetcris').className = 'tab-active px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
                document.getElementById('seccionBetcris').classList.remove('hidden');
            } else if (tab === 'rusos') {
                document.getElementById('tabRusos').className = 'tab-active px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
                document.getElementById('seccionRusos').classList.remove('hidden');
            } else if (tab === 'transacciones') {
                document.getElementById('tabTransacciones').className = 'tab-active px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
                document.getElementById('seccionTransacciones').classList.remove('hidden');
            } else if (tab === 'graficas') {
                document.getElementById('tabGraficas').className = 'tab-active px-6 py-3 rounded-lg font-semibold transition-all cursor-pointer';
                document.getElementById('seccionGraficas').classList.remove('hidden');
                actualizarGraficas();
            }
        }

        function cargarDatos() {
            const t = localStorage.getItem('transaccionesUSDT');
            const rb = localStorage.getItem('recogidasBetcris');
            const cb = localStorage.getItem('comprasBetcris');
            const vr = localStorage.getItem('ventasRusos');
            
            if (t) transacciones = JSON.parse(t);
            if (rb) recogidasBetcris = JSON.parse(rb);
            if (cb) comprasBetcris = JSON.parse(cb);
            if (vr) ventasRusos = JSON.parse(vr);
            
            actualizarTablaBetcris();
            actualizarTablaRusos();
            actualizarTablaTransacciones();
        }

        function guardarDatos() {
            localStorage.setItem('transaccionesUSDT', JSON.stringify(transacciones));
            localStorage.setItem('recogidasBetcris', JSON.stringify(recogidasBetcris));
            localStorage.setItem('comprasBetcris', JSON.stringify(comprasBetcris));
            localStorage.setItem('ventasRusos', JSON.stringify(ventasRusos));
        }

        function agregarRecogidaBetcris() {
            const fecha = document.getElementById('fechaRecogidaBetcris').value;
            const dop = parseFloat(document.getElementById('montoDOPBetcris').value) || 0;
            const usd = parseFloat(document.getElementById('montoUSDBetcris').value) || 0;
            const tasa = parseFloat(document.getElementById('tasaDiaBetcris').value) || 0;

            if (!fecha || (dop === 0 && usd === 0)) {
                alert('Completa fecha y al menos un monto');
                return;
            }

            const dopAUsd = tasa > 0 ? dop / tasa : 0;
            const totalUsd = dopAUsd + usd;
            const usdtLiquidar = totalUsd / 1.03;

            recogidasBetcris.push({
                id: Date.now(),
                fecha,
                dop,
                usd,
                tasa,
                totalUsd,
                usdtLiquidar
            });

            guardarDatos();
            actualizarTablaBetcris();

            document.getElementById('montoDOPBetcris').value = '';
            document.getElementById('montoUSDBetcris').value = '';
            document.getElementById('tasaDiaBetcris').value = '';
        }

        function eliminarRecogidaBetcris(id) {
            if (confirm('¬øEliminar?')) {
                recogidasBetcris = recogidasBetcris.filter(r => r.id !== id);
                guardarDatos();
                actualizarTablaBetcris();
            }
        }

        function agregarCompraBetcris() {
            const fecha = document.getElementById('fechaCompraBetcris').value;
            const cantidad = parseFloat(document.getElementById('cantidadUSDTBetcris').value);
            const precio = parseFloat(document.getElementById('precioUSDTBetcris').value);
            const divisa = document.getElementById('divisaCompraBetcris').value;
            const notas = document.getElementById('notasCompraBetcris').value;

            if (!fecha || !cantidad || !precio) {
                alert('Completa fecha, cantidad y precio');
                return;
            }

            comprasBetcris.push({
                id: Date.now(),
                fecha,
                cantidad,
                precio,
                divisa,
                total: cantidad * precio,
                notas
            });

            guardarDatos();
            actualizarTablaBetcris();

            document.getElementById('cantidadUSDTBetcris').value = '';
            document.getElementById('precioUSDTBetcris').value = '';
            document.getElementById('notasCompraBetcris').value = '';
        }

        function eliminarCompraBetcris(id) {
            if (confirm('¬øEliminar?')) {
                comprasBetcris = comprasBetcris.filter(c => c.id !== id);
                guardarDatos();
                actualizarTablaBetcris();
            }
        }

        function actualizarTablaBetcris() {
            const tbody1 = document.getElementById('tablaRecogidasBetcris');
            const tbody2 = document.getElementById('tablaComprasBetcris');
            tbody1.innerHTML = '';
            tbody2.innerHTML = '';

            let totalALiquidar = 0;
            let totalComprado = 0;

            recogidasBetcris.forEach(r => {
                totalALiquidar += r.usdtLiquidar;
                tbody1.innerHTML += `
                    <tr class="border-b border-white/10">
                        <td class="py-3 px-3">${r.fecha}</td>
                        <td class="text-right py-3 px-3">${r.dop.toFixed(2)}</td>
                        <td class="text-right py-3 px-3">${r.usd.toFixed(2)}</td>
                        <td class="text-right py-3 px-3">${r.tasa > 0 ? r.tasa.toFixed(2) : '-'}</td>
                        <td class="text-right py-3 px-3 text-emerald-400 font-semibold">${r.totalUsd.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 text-yellow-400 font-bold">${r.usdtLiquidar.toFixed(2)}</td>
                        <td class="text-center py-3 px-3">
                            <button onclick="eliminarRecogidaBetcris(${r.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });

            comprasBetcris.forEach(c => {
                totalComprado += c.cantidad;
                tbody2.innerHTML += `
                    <tr class="border-b border-white/10">
                        <td class="py-3 px-3">${c.fecha}</td>
                        <td class="text-right py-3 px-3 font-semibold">${c.cantidad.toFixed(2)}</td>
                        <td class="text-right py-3 px-3">${c.precio.toFixed(2)}</td>
                        <td class="text-center py-3 px-3"><span class="px-2 py-1 bg-slate-700 rounded text-xs">${c.divisa}</span></td>
                        <td class="text-right py-3 px-3 text-emerald-400 font-semibold">${c.total.toFixed(2)}</td>
                        <td class="py-3 px-3 text-xs">${c.notas || '-'}</td>
                        <td class="text-center py-3 px-3">
                            <button onclick="eliminarCompraBetcris(${c.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('totalALiquidarBetcris').textContent = totalALiquidar.toFixed(2);
            document.getElementById('totalCompradosBetcris').textContent = totalComprado.toFixed(2);
            document.getElementById('pendienteBetcris').textContent = (totalALiquidar - totalComprado).toFixed(2);
        }

        function agregarVentaRusos() {
            const fecha = document.getElementById('fechaRusos').value;
            const usdt = parseFloat(document.getElementById('cantidadUSDTRusos').value);
            const porcentaje = parseFloat(document.getElementById('porcentajeRusos').value);
            const notas = document.getElementById('notasRusos').value;

            if (!fecha || !usdt || !porcentaje) {
                alert('Completa fecha, USDT y porcentaje');
                return;
            }

            const gananciaTotal = usdt * (porcentaje / 100);
            const tuParte = gananciaTotal / 2;
            const parteSocio = gananciaTotal / 2;

            ventasRusos.push({
                id: Date.now(),
                fecha,
                usdt,
                porcentaje,
                gananciaTotal,
                tuParte,
                parteSocio,
                notas
            });

            guardarDatos();
            actualizarTablaRusos();

            document.getElementById('cantidadUSDTRusos').value = '';
            document.getElementById('porcentajeRusos').value = '';
            document.getElementById('notasRusos').value = '';
        }

        function eliminarVentaRusos(id) {
            if (confirm('¬øEliminar?')) {
                ventasRusos = ventasRusos.filter(v => v.id !== id);
                guardarDatos();
                actualizarTablaRusos();
            }
        }

        function actualizarTablaRusos() {
            const tbody = document.getElementById('tablaVentasRusos');
            tbody.innerHTML = '';

            let totalGanancia = 0;
            let totalTuParte = 0;
            let totalSocio = 0;

            ventasRusos.forEach(v => {
                totalGanancia += v.gananciaTotal;
                totalTuParte += v.tuParte;
                totalSocio += v.parteSocio;

                tbody.innerHTML += `
                    <tr class="border-b border-white/10">
                        <td class="py-3 px-3">${v.fecha}</td>
                        <td class="text-right py-3 px-3 font-semibold">${v.usdt.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 text-yellow-400">${v.porcentaje.toFixed(2)}%</td>
                        <td class="text-right py-3 px-3 text-emerald-400 font-bold">${v.gananciaTotal.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 text-blue-400 font-semibold">${v.tuParte.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 text-cyan-400 font-semibold">${v.parteSocio.toFixed(2)}</td>
                        <td class="py-3 px-3 text-xs">${v.notas || '-'}</td>
                        <td class="text-center py-3 px-3">
                            <button onclick="eliminarVentaRusos(${v.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('gananciaTotalRusos').textContent = ' + totalGanancia.toFixed(2);
            document.getElementById('tuParteRusos').textContent = ' + totalTuParte.toFixed(2);
            document.getElementById('parteSocioRusos').textContent = ' + totalSocio.toFixed(2);
        }

        function agregarTransaccion() {
            const tipo = document.getElementById('tipo').value;
            const cantidadUSDT = parseFloat(document.getElementById('cantidadUSDT').value);
            const divisaPago = document.getElementById('divisaPago').value;
            const divisaPrecios = document.getElementById('divisaPrecios').value;
            const precioMercado = parseFloat(document.getElementById('precioMercado').value);
            const tuPrecio = parseFloat(document.getElementById('tuPrecio').value);
            const tasaCambio = parseFloat(document.getElementById('tasaCambio').value) || null;
            const notas = document.getElementById('notas').value;
            const fecha = document.getElementById('fecha').value;

            if (!cantidadUSDT || !precioMercado || !tuPrecio || !fecha) {
                alert('Completa los campos obligatorios');
                return;
            }

            const gananciaPorUSDT = tipo === 'Compra' ? precioMercado - tuPrecio : tuPrecio - precioMercado;
            const gananciaTotal = gananciaPorUSDT * cantidadUSDT;

            transacciones.push({
                id: Date.now(),
                tipo,
                cantidadUSDT,
                divisaPago,
                divisaPrecios,
                precioMercado,
                tuPrecio,
                gananciaPorUSDT,
                gananciaTotal,
                tasaCambio,
                notas,
                fecha
            });

            guardarDatos();
            actualizarTablaTransacciones();

            document.getElementById('cantidadUSDT').value = '';
            document.getElementById('precioMercado').value = '';
            document.getElementById('tuPrecio').value = '';
            document.getElementById('tasaCambio').value = '';
            document.getElementById('notas').value = '';
        }

        function eliminarTransaccion(id) {
            if (confirm('¬øEliminar?')) {
                transacciones = transacciones.filter(t => t.id !== id);
                guardarDatos();
                actualizarTablaTransacciones();
            }
        }

        function actualizarTablaTransacciones() {
            const tbody = document.getElementById('tablaTransacciones');
            tbody.innerHTML = '';

            let totalComprados = 0;
            let totalVendidos = 0;

            transacciones.forEach(t => {
                if (t.tipo === 'Compra') totalComprados += t.cantidadUSDT;
                else totalVendidos += t.cantidadUSDT;

                const colorTipo = t.tipo === 'Compra' ? 'bg-blue-500/20 text-blue-300' : 'bg-orange-500/20 text-orange-300';
                const colorGan = t.gananciaTotal > 0 ? 'text-green-400' : 'text-red-400';

                tbody.innerHTML += `
                    <tr class="border-b border-white/10">
                        <td class="py-3 px-3"><span class="${colorTipo} px-3 py-1 rounded-full text-xs">${t.tipo}</span></td>
                        <td class="text-right py-3 px-3 font-semibold">${t.cantidadUSDT.toFixed(2)}</td>
                        <td class="text-center py-3 px-3"><span class="px-2 py-1 bg-slate-700 rounded text-xs">${t.divisaPrecios}</span></td>
                        <td class="text-right py-3 px-3">${t.precioMercado.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 font-semibold">${t.tuPrecio.toFixed(2)}</td>
                        <td class="text-right py-3 px-3 ${colorGan} font-bold">${t.gananciaTotal.toFixed(2)}</td>
                        <td class="text-center py-3 px-3">${t.fecha}</td>
                        <td class="text-center py-3 px-3">
                            <button onclick="eliminarTransaccion(${t.id})" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('totalComprados').textContent = totalComprados.toFixed(2);
            document.getElementById('totalVendidos').textContent = totalVendidos.toFixed(2);
            document.getElementById('balanceUSDT').textContent = (totalComprados - totalVendidos).toFixed(2);
        }

        function actualizarGraficas() {
            const meses = {};
            transacciones.forEach(t => {
                const mes = t.fecha.substring(0, 7);
                meses[mes] = (meses[mes] || 0) + t.gananciaTotal;
            });

            const ctxGan = document.getElementById('graficoGanancias');
            if (window.chartGan) window.chartGan.destroy();
            window.chartGan = new Chart(ctxGan, {
                type: 'line',
                data: {
                    labels: Object.keys(meses).sort(),
                    datasets: [{
                        label: 'Ganancias',
                        data: Object.keys(meses).sort().map(m => meses[m]),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });

            const compras = transacciones.filter(t => t.tipo === 'Compra').reduce((s, t) => s + t.cantidadUSDT, 0);
            const ventas = transacciones.filter(t => t.tipo === 'Venta').reduce((s, t) => s + t.cantidadUSDT, 0);

            const ctxCV = document.getElementById('graficoComprasVentas');
            if (window.chartCV) window.chartCV.destroy();
            window.chartCV = new Chart(ctxCV, {
                type: 'doughnut',
                data: {
                    labels: ['Compras', 'Ventas'],
                    datasets: [{
                        data: [compras, ventas],
                        backgroundColor: ['#3b82f6', '#f97316']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } }
                }
            });
        }
    </script>
</body>
</html>
